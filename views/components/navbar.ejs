<nav class="navbar bg-body-tertiary navbar-gradient">
  <div class="container">
    <!-- Logo -->
    <a class="navbar-brand d-flex align-items-center" href="/" aria-label="Página inicial">
      <img src="https://plpstore.com.br/img/logo.png" alt="Logo PLP Store" width="50" height="50" class="me-2" id="logo-link">
      <span class="fw-bold">PLP Store</span>
    </a>

    <!-- Busca (oculto em mobile) -->
    <form class="d-none d-md-flex m-auto" action="/buscar" method="GET">
      <div class="col-auto">
        <input class="form-control m-auto" type="search" placeholder="Buscar na PLP Store" aria-label="Buscar"
          id="campoBusca" name="busca">
      </div>
      <div class="col-auto m-auto">
        <button class="btn btn-outline-dark" type="submit" aria-label="Pesquisar">
          <i class="bi bi-search"></i>
        </button>
      </div>
    </form>

    <div class="d-flex align-items-center">
      <!-- Carrinho -->
      <a class="btn btn-carrinho-navbar btn-outline-dark position-relative me-3" href="/carrinho-compras">
        <i class="bi bi-cart-fill"></i>
        <span class="position-absolute start-100 translate-middle badge rounded-pill bg-danger" id="quantidadeCarrinho">
          <%= carrinho.obterQuantidadeTotal() %>
        </span>
      </a>

      <!-- Login -->
      <button class="btn btn-outline-dark" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar"
        aria-controls="offcanvasNavbar" aria-label="Abrir menu de login">
        <i class="bi bi-person-circle"></i>
        <span class="d-none d-md-inline">Login</span>
      </button>
    </div>

    <!-- Offcanvas Login -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Acesse sua conta</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Fechar"></button>
      </div>
      <div class="offcanvas-body">
        <form action="/login" method="POST">
          <input type="hidden" name="_csrf" value="futuroToken">
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email" name="email" placeholder="seuemail@exemplo.com" required>
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Senha</label>
            <input type="password" class="form-control" id="password" name="password" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">Entrar</button>
        </form>
        <hr>
        <p class="text-center mb-0">
          <a href="/recuperar-senha" class="text-decoration-none">Esqueceu a senha?</a>
        </p>
      </div>
    </div>
  </div>
</nav>

<script>
  // Função para atualizar a quantidade do carrinho
  function atualizarQuantidadeCarrinho() {
    fetch('/carrinho')
      .then(response => {
        if (!response.ok) {
          throw new Error('Erro ao buscar o carrinho');
        }
        return response.json();
      })
      .then(data => {
        const carrinhoQtd = document.getElementById('quantidadeCarrinho');

        if (!carrinhoQtd) {
          console.error('Elemento carrinhoQtd não encontrado.');
          return;
        }

        // Atualizando o conteúdo e visibilidade do badge
        if (data && data.obterQuantidadeTotal() > 0) {
          carrinhoQtd.textContent = data.totalItens;
          carrinhoQtd.style.display = "inline-block";
        } else {
          carrinhoQtd.textContent = "";
          carrinhoQtd.style.display = "none";
        }
      })
      .catch(error => {
        console.error('Erro ao atualizar o carrinho:', error);
      });
  }

  // Atualizar o carrinho assim que a página for carregada
  document.addEventListener('DOMContentLoaded', atualizarQuantidadeCarrinho);
</script>
